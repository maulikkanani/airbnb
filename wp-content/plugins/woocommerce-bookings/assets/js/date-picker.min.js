jQuery(function(e){var a=0,t={init:function(){e("body").on("change","#wc_bookings_field_duration, #wc_bookings_field_resource",this.date_picker_init),e("body").on("click",".wc-bookings-date-picker legend small.wc-bookings-date-picker-choose-date",this.toggle_calendar),e("body").on("input",".booking_date_year, .booking_date_month, .booking_date_day",this.input_date_trigger),e("body").on("keypress",".booking_date_year, .booking_date_month, .booking_date_day",this.input_date_keypress),e("body").on("keypress",".booking_to_date_year, .booking_to_date_month, .booking_to_date_day",this.input_date_keypress),e("body").on("change",".booking_to_date_year, .booking_to_date_month, .booking_to_date_day",this.input_date_trigger),e(".wc-bookings-date-picker legend small.wc-bookings-date-picker-choose-date").show(),e(".wc-bookings-date-picker").each(function(){var a=e(this).closest("form"),i=a.find(".picker"),o=e(this).closest("fieldset");t.date_picker_init(i),"always_visible"==i.data("display")?(e(".wc-bookings-date-picker-date-fields",o).hide(),e(".wc-bookings-date-picker-choose-date",o).hide()):i.hide(),i.data("is_range_picker_enabled")&&(a.find("p.wc_bookings_field_duration").hide(),a.find(".wc_bookings_field_start_date legend span.label").text("always_visible"!==i.data("display")?booking_form_params.i18n_dates:booking_form_params.i18n_start_date))})},calc_duration:function(e){var a=e.closest("form"),t=e.closest("fieldset"),i=e.data("duration-unit");setTimeout(function(){var e=1,o=parseInt(t.find("input.booking_to_date_year").val(),10),n=parseInt(t.find("input.booking_to_date_month").val(),10),_=parseInt(t.find("input.booking_to_date_day").val(),10),d=parseInt(t.find("input.booking_date_year").val(),10),r=parseInt(t.find("input.booking_date_month").val(),10),s=parseInt(t.find("input.booking_date_day").val(),10);if(o&&n>=0&&_&&d&&r>=0&&s){var l=new Date(Date.UTC(d,r-1,s)),b=new Date(Date.UTC(o,n-1,_));e=Math.floor((b.getTime()-l.getTime())/864e5),"day"===i&&(e+=1)}a.find("#wc_bookings_field_duration").val(e).change()})},toggle_calendar:function(){$picker=e(this).closest("fieldset").find(".picker:eq(0)"),t.date_picker_init($picker),$picker.slideToggle()},input_date_keypress:function(){var i=e(this).closest("fieldset"),o=i.find(".picker:eq(0)");o.data("is_range_picker_enabled")&&(clearTimeout(a),a=setTimeout(t.trigger_cost_update,800))},trigger_cost_update:function(){e(".wc-bookings-booking-form").find("input").eq(0).trigger("change")},input_date_trigger:function(){var a=e(this).closest("fieldset"),t=a.find(".picker:eq(0)"),i=(e(this).closest("form"),parseInt(a.find("input.booking_date_year").val(),10)),o=parseInt(a.find("input.booking_date_month").val(),10),n=parseInt(a.find("input.booking_date_day").val(),10);if(i&&o&&n){var _=new Date(i,o-1,n);if(t.datepicker("setDate",_),t.data("is_range_picker_enabled")){var d=parseInt(a.find("input.booking_to_date_year").val(),10),r=parseInt(a.find("input.booking_to_date_month").val(),10),s=parseInt(a.find("input.booking_to_date_day").val(),10),l=new Date(d,r-1,s);!l||_>l?(a.find("input.booking_to_date_year").val("").addClass("error"),a.find("input.booking_to_date_month").val("").addClass("error"),a.find("input.booking_to_date_day").val("").addClass("error")):a.find("input").removeClass("error")}a.triggerHandler("date-selected",_)}},select_date_trigger:function(a){var i=e(this).closest("fieldset"),o=i.find(".picker:eq(0)"),n=e(this).closest("form"),_=a.split("-"),d=o.data("start_or_end_date");o.data("is_range_picker_enabled")&&d||(d="start"),"end"===d?(o.data("min_date",o.data("o_min_date")),i.find("input.booking_to_date_year").val(_[0]),i.find("input.booking_to_date_month").val(_[1]),i.find("input.booking_to_date_day").val(_[2]).change(),o.data("is_range_picker_enabled")&&t.calc_duration(o),o.data("start_or_end_date","start"),o.data("is_range_picker_enabled")&&n.find(".wc_bookings_field_start_date legend span.label").text("always_visible"!==o.data("display")?booking_form_params.i18n_dates:booking_form_params.i18n_start_date),"always_visible"!==o.data("display")&&e(this).hide()):(o.data("is_range_picker_enabled")&&(o.data("o_min_date",o.data("min_date")),o.data("min_date",a)),i.find("input.booking_to_date_year").val(""),i.find("input.booking_to_date_month").val(""),i.find("input.booking_to_date_day").val(""),i.find("input.booking_date_year").val(_[0]),i.find("input.booking_date_month").val(_[1]),i.find("input.booking_date_day").val(_[2]).change(),o.data("is_range_picker_enabled")&&t.calc_duration(o),o.data("start_or_end_date","end"),o.data("is_range_picker_enabled")&&n.find(".wc_bookings_field_start_date legend span.label").text(booking_form_params.i18n_end_date),"always_visible"===o.data("display")||o.data("is_range_picker_enabled")||e(this).hide()),i.triggerHandler("date-selected",a,d)},date_picker_init:function(a){var i;i=e(a).is(".picker")?e(a):e(this).closest("form").find(".picker:eq(0)"),i.empty().removeClass("hasDatepicker").datepicker({dateFormat:e.datepicker.ISO_8601,showWeek:!1,showOn:!1,beforeShowDay:t.is_bookable,onSelect:t.select_date_trigger,minDate:i.data("min_date"),maxDate:i.data("max_date"),defaultDate:i.data("default_date"),numberOfMonths:1,showButtonPanel:!1,showOtherMonths:!0,selectOtherMonths:!0,closeText:wc_bookings_booking_form.closeText,currentText:wc_bookings_booking_form.currentText,prevText:wc_bookings_booking_form.prevText,nextText:wc_bookings_booking_form.nextText,monthNames:wc_bookings_booking_form.monthNames,monthNamesShort:wc_bookings_booking_form.monthNamesShort,dayNames:wc_bookings_booking_form.dayNames,dayNamesShort:wc_bookings_booking_form.dayNamesShort,dayNamesMin:wc_bookings_booking_form.dayNamesMin,firstDay:wc_bookings_booking_form.firstDay,gotoCurrent:!0}),e(".ui-datepicker-current-day").removeClass("ui-datepicker-current-day");var o=i.closest("form"),n=parseInt(o.find("input.booking_date_year").val(),10),_=parseInt(o.find("input.booking_date_month").val(),10),d=parseInt(o.find("input.booking_date_day").val(),10);if(n&&_&&d){var r=new Date(n,_-1,d);i.datepicker("setDate",r)}},get_input_date:function(e,a){var t=e.find("input.booking_"+a+"date_year"),i=e.find("input.booking_"+a+"date_month"),o=e.find("input.booking_"+a+"date_day");return 0!==t.val().length&&0!==i.val().length&&0!==o.val().length?t.val()+"-"+i.val()+"-"+o.val():""},is_bookable:function(a){var i=e(this).closest("form"),o=i.find(".picker:eq(0)"),n=e(this).data("availability"),_=e(this).data("default-availability"),d=e(this).data("fully-booked-days"),r=e(this).data("buffer-days"),s=e(this).data("partially-booked-days"),l=wc_bookings_booking_form.check_availability_against,b="",k="",c=0,f=wc_bookings_booking_form.resources_assignment;i.find("select#wc_bookings_field_resource").val()>0&&(c=i.find("select#wc_bookings_field_resource").val());var g=wc_bookings_booking_form.booking_duration,u=new Date(a),p=u.getFullYear(),y=u.getMonth()+1,m=u.getDate();if(d[p+"-"+y+"-"+m]&&(d[p+"-"+y+"-"+m][0]||d[p+"-"+y+"-"+m][c]))return[!1,"fully_booked",booking_form_params.i18n_date_fully_booked];if("undefined"!=typeof r&&r[p+"-"+y+"-"+m])return[!1,"not_bookable",booking_form_params.i18n_date_unavailable];if(""+p+y+m<wc_bookings_booking_form.current_time)return[!1,"not_bookable",booking_form_params.i18n_date_unavailable];s&&s[p+"-"+y+"-"+m]&&(s[p+"-"+y+"-"+m][0]||s[p+"-"+y+"-"+m][c])&&(b+="partial_booked ");var v=g;if(i.find("#wc_bookings_field_duration").size()>0&&"minute"!=wc_bookings_booking_form.duration_unit&&"hour"!=wc_bookings_booking_form.duration_unit&&!o.data("is_range_picker_enabled")){var h=i.find("#wc_bookings_field_duration").val();v=g*h}(1>v||"start"===l)&&(v=1);var w={start_date:a,number_of_days:v,fully_booked_days:d,availability:n,default_availability:_,resource_id:c,resources_assignment:f},D=t.is_blocks_bookable(w);if(D){if(k=b.indexOf("partial_booked")>-1?booking_form_params.i18n_date_partially_booked:booking_form_params.i18n_date_available,o.data("is_range_picker_enabled")){var I=e(this).closest("fieldset"),T=e.datepicker.parseDate(e.datepicker.ISO_8601,t.get_input_date(I,"")),x=e.datepicker.parseDate(e.datepicker.ISO_8601,t.get_input_date(I,"to_"));return[D,T&&(a.getTime()===T.getTime()||x&&a>=T&&x>=a)?b+"bookable-range":b+"bookable",k]}return[D,b+"bookable",k]}return[D,"not_bookable",booking_form_params.i18n_date_unavailable]},is_blocks_bookable:function(a){for(var i=a.default_availability,o=0;o<a.number_of_days;o++){var n=new Date(a.start_date);n.setDate(n.getDate()+o);var _=n.getFullYear(),d=n.getMonth()+1,r=n.getDate(),s=n.getDay();e.datepicker.iso8601Week(n);0===s&&(s=7);var l={resource_rules:a.availability[a.resource_id],date:n,default_availability:a.default_availability};if(i=t.is_resource_available(l),"automatic"===a.resources_assignment){var b=e.extend({availability:a.availability,fully_booked_days:a.fully_booked_days},l);i=t.has_available_resource(b)}if(a.fully_booked_days[_+"-"+d+"-"+r]&&(a.fully_booked_days[_+"-"+d+"-"+r][0]||a.fully_booked_days[_+"-"+d+"-"+r][a.resource_id])&&(i=!1),!i)break}return i},is_resource_available:function(a){var t=a.default_availability,i=a.date.getFullYear(),o=a.date.getMonth()+1,n=a.date.getDate(),_=a.date.getDay(),d=e.datepicker.iso8601Week(a.date);return 0===_&&(_=7),a.fully_booked_days&&a.fully_booked_days[i+"-"+o+"-"+n]&&a.fully_booked_days[i+"-"+o+"-"+n][a.resource_id]?!1:(e.each(a.resource_rules,function(e,r){var s=r[0],l=r[1];try{switch(s){case"months":if("undefined"!=typeof l[o])return t=l[o],!1;break;case"weeks":if("undefined"!=typeof l[d])return t=l[d],!1;break;case"days":if("undefined"!=typeof l[_])return t=l[_],!1;break;case"custom":if("undefined"!=typeof l[i][o][n])return t=l[i][o][n],!1;break;case"time":case"time:1":case"time:2":case"time:3":case"time:4":case"time:5":case"time:6":case"time:7":if(!1===a.default_availability&&(_===l.day||0===l.day))return t=l.rule,!1;break;case"time:range":if(!1===a.default_availability&&"undefined"!=typeof l[i][o][n])return t=l[i][o][n].rule,!1}}catch(b){}return!0}),t)},has_available_resource:function(e){for(var a in e.availability)if(a=parseInt(a,10),0!==a&&(e.resource_rules=e.availability[a],e.resource_id=a,t.is_resource_available(e)))return!0;return!1}};t.init()});